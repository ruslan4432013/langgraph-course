# Чат-бот с саммаризацией сообщений и памятью на LangGraph

Данный проект представляет собой учебный пример реализации интеллектуального чат-бота с использованием библиотеки *
*LangGraph**. Бот обладает способностью сохранять контекст беседы и автоматически суммировать историю сообщений, когда
она становится слишком длинной.

## Основные возможности

* **Память (Short-term memory):** Использование `MemorySaver` для хранения истории переписки в рамках конкретного
  потока (thread).
* **Автоматическая саммаризация:** Бот отслеживает количество сообщений и при превышении лимита (6 сообщений) сжимает их
  в краткое резюме.
* **Управление состоянием:** Расширенное состояние (State), включающее в себя не только список сообщений, но и
  накопленное резюме беседы.

## Визуализация графа

Логика работы бота представлена в виде графа. Ниже приведена его визуализация:

![Визуализация графа](./static/img.png)

## Логика работы графа

1. **START**: Входная точка. Переход к узлу `conversation`.
2. **conversation**: Узел, отвечающий за взаимодействие с LLM. Он подготавливает сообщения, добавляя текущее резюме (
   если оно есть) в качестве контекста.
3. **should_continue**: Условное ребро. Проверяет количество сообщений в состоянии:
    * Если сообщений более 6 — переход к `summarize_conversation`.
    * Если сообщений 6 или меньше — завершение работы (`END`).
4. **summarize_conversation**: Узел, который создает краткое содержание текущей беседы и удаляет старые сообщения,
   оставляя только резюме и последние две реплики для поддержания непосредственного контекста.

## Структура проекта

* `src/main.py` — Определение графа, узлов и логики переходов.
* `src/settings.py` — Управление настройками и переменными окружения через Pydantic.
* `langgraph.json` — Конфигурация для запуска графа в LangGraph Studio или через CLI.
* `static/img.png` — Изображение с визуализацией структуры графа.

## Настройка и запуск

### 1. Подготовка окружения

Создайте файл `.env` в корневом каталоге и укажите необходимые ключи:

```env
OPENAI_API_KEY=your_api_key_here
LANGSMITH_API_KEY=your_langsmith_key_here
LANGSMITH_TRACING=true
LANGSMITH_ENDPOINT=https://api.smith.langchain.com
LANGSMITH_PROJECT=your_project_name
```

### 2. Установка зависимостей

Рекомендуется использовать виртуальное окружение:

```bash
python -m venv .venv
source .venv/bin/activate  # Для macOS/Linux
pip install -r requirements.txt
```

### 3. Запуск

Граф настроен для использования с **LangGraph CLI**. Вы можете запустить его с помощью:

```bash
langgraph dev
```

Или использовать в своем коде, импортировав `graph` из `src.main`.

---
*Учебный проект для курса по LangGraph.*
