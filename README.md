# LangGraph: Управление состоянием (State Management)

Этот проект представляет собой учебный пример по работе с состоянием (State) в библиотеке LangGraph. Здесь
демонстрируются ключевые механизмы управления данными внутри графа, от простых схем до сложных редьюсеров и управления
историей сообщений.

## Содержание

1. [Обзор концепций](#обзор-концепций)
2. [Основные примеры](#основные-примеры)
3. [Структура проекта](#структура-проекта)
4. [Установка и запуск](#установка-и-запуск)

---

## Обзор концепций

### 1. Схема состояния (State)

В LangGraph состояние определяется с помощью стандартных Python-типов, таких как `TypedDict`. Оно служит общим
хранилищем данных, к которому имеют доступ все узлы графа.

### 2. Редьюсеры (Reducers)

Редьюсеры определяют, как обновлять конкретные поля в состоянии. По умолчанию новое значение просто перезаписывает
старое. С помощью `Annotated` и функций (например, `operator.add`), можно настроить накопление данных или объединение
списков.

### 3. Управление сообщениями

Специальная функция `add_messages` упрощает работу с массивами сообщений (BaseMessage), позволяя:

- Автоматически добавлять новые сообщения в конец списка.
- Обновлять существующие сообщения, если совпадает их `id`.
- Удалять сообщения с помощью `RemoveMessage`.

---

## Основные примеры

В файле `src/main.py` содержатся следующие учебные блоки:

- **Базовый граф**: Создание простого узла и переход от START к END.
- **Обработка конфликтов**: Демонстрация ошибки `InvalidUpdateError` при попытке одновременного обновления одного поля
  без редьюсера.
- **Использование Reducers**: Применение `Annotated[list[int], add]` для корректного слияния результатов из разных
  узлов.
- **Custom Reducer**: Реализация логики безопасного обновления данных.
- **Работа с сообщениями**: Примеры использования `add_messages` для добавления, обновления и удаления сообщений из
  истории чата.

---

## Структура проекта

- `src/main.py` — основной файл с примерами кода.
- `langgraph.json` — файл конфигурации для LangGraph Studio.
- `requirements.txt` — список необходимых зависимостей.

---

## Установка и запуск

### Предварительные требования

- Python 3.10 или выше.
- Установленный `pip`.

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone <url_репозитория>
   cd langgraph-course
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

### Запуск

Для запуска примеров по управлению состоянием:

```bash
python src/main.py
```

*Примечание: Чтобы просмотреть разные примеры в `src/main.py`, раскомментируйте соответствующие блоки кода и
закомментируйте другие.*
