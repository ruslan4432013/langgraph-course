# LangGraph Router Example

Этот проект представляет собой учебный пример реализации роутера (условных переходов)
в [LangGraph](https://github.com/langchain-ai/langgraph). Пример демонстрирует, как агент может динамически выбирать
между выполнением инструментов и завершением работы.

## Схема графа

Ниже представлена визуализация графа, используемого в этом примере:

![Схема графа](static/img.png)

## Основные компоненты

Граф построен с использованием `StateGraph` и включает в себя следующие элементы:

1. **Nodes (Узлы):**
    * `tool_calling_llm`: Узел, в котором вызывается языковая модель. Ей передан список доступных инструментов (в данном
      примере — функция `multiply`).
    * `tools`: Узел, отвечающий за выполнение вызванных инструментов. Реализован через кастомный класс `BasicToolNode`.

2. **Conditional Edges (Условные переходы):**
    * Функция `tools_condition` выступает в роли роутера. Она проверяет последнее сообщение в состоянии (state):
        * Если сообщение содержит запрос на вызов инструментов (`tool_calls`), поток направляется в узел `tools`.
        * В противном случае поток направляется в `END`, завершая работу графа.

3. **State (Состояние):**
    * Используется стандартный `MessagesState`, который хранит историю переписки в виде списка сообщений.

## Настройка окружения

1. Установите необходимые зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. Настройте переменные окружения. Создайте файл `.env` в корневом каталоге и добавьте в него следующие параметры (см.
   `src/settings.py` и `.env.example`):
   ```env
   OPENAI_API_KEY=your_openai_api_key
   LANGSMITH_TRACING=true
   LANGSMITH_ENDPOINT=https://api.smith.langchain.com
   LANGSMITH_API_KEY=your_langsmith_api_key
   LANGSMITH_PROJECT=your_project_name
   ```

## Запуск

Для запуска примера выполните скрипт:

```bash
python src/main.py
```

Скрипт выполнит тестовый запрос ("Сколько будет 2 * 3?") и выведет цепочку сообщений, включая вызов инструмента и
итоговый ответ.

## Файловая структура

* `src/main.py` — определение графа, узлов и логики маршрутизации.
* `src/settings.py` — конфигурация приложения с использованием `pydantic-settings`.
* `static/img.png` — визуализация графа.
* `langgraph.json` — файл конфигурации для интеграции с LangGraph Studio.
